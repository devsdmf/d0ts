#!/bin/bash

system_type=$(uname -s)

if [ "$system_type" = "Darwin"  ]; then

  # install homebrew if it's missing
  if ! command -v brew >/dev/null 2>&1; then
    echo "Installing homebrew"
    /usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
  fi

  if [ -f "$HOME/.Brewfile"  ]; then
    echo "Updating homebrew bundle"
    brew bundle --global
  fi

elif [ "$system_type" = "Linux" ]; then
  # install packages
  echo "Installing shell essentials..."
  sudo apt-get install zsh tmux coreutils openssl wget curl tree cmake dirmngr apt-transport-https # default tools

  echo "Installing essential tools..."
  sudo apt-get install htop ncdu
  sudo curl -0 https://raw.githubusercontent.com/denilsonsa/prettyping/master/prettyping > /usr/local/bin/prettyping && sudo chmod +x /usr/local/bin/prettyping # prettyping
  git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf && ~/.fzf/install

  echo "Installing development tools..."
  sudo apt-get install gcc llvm python python3
  # add php installation here

  # java 8
  echo "deb http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main" | sudo tee /etc/apt/sources.list.d/webupd8team-java.list
  echo "deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu trusty main" | sudo tee -a /etc/apt/sources.list.d/webupd8team-java.list
  sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys EEA14886
  sudo apt-get update && sudo apt-get install oracle-java8-installer && sudo apt-get install oracle-java8-set-default

  # ant maven
  sudo apt-get install ant maven

  # scala
  echo "deb https://dl.bintray.com/sbt/debian /" | sudo tee -a /etc/apt/sources.list.d/sbt.list
  sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2EE0EA64E40A89B84B2DF73499E82A75642AC823
  sudo apt-get update && sudo apt-get install sbt scala

  echo "Setting up zsh as default shell..."
  chsh -s $(which zsh)

  echo "Installing oh-my-zsh"
  sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"

  echo "Installing zsh theme..."
  curl -0 https://raw.githubusercontent.com/devsdmf/zsh-theme/master/devsdmf.zsh-theme > $HOME/.oh-my-zsh/themes/devsdmf.zsh-theme

  echo "Reverting .zshrc file..."
  mv ~/.zshrc.pre-oh-my-zsh ~/.zshrc

  echo "Reloading shell..."
  exec zsh

fi
